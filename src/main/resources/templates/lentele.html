<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>Lentelė</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://jqueryui.com/resources/demos/style.css">
    
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.js"></script> <!-- TINKA -->
    <script type="text/javascript" src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script> <!--  TINKA -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	<script>
		$(document).ready(function()
           {
   			var dialog_prideti, form_prideti;
   			//Pridejimas
               dialog_prideti = $( "#div_sukurti" ).dialog(
               {
                   autoOpen: false,
                   height: 300,
                   width: 300,
                   modal: true,
                   buttons:
                   {
                       "Patvirtinti": sukurtiPreke,
                       Cancel: function()
                       {
                       	dialog_prideti.dialog( "close" ); 
                       }
                   }
               });
   			
               $( "#button_sukurti" ).button().on( "click", function()
               {
               	dialog_prideti.dialog( "open" );
               });
               
               form_prideti = dialog_prideti.find( "form" );
               
   		    function sukurtiPreke()
   		    {
   		        $("#sukurimo_forma").submit();
   		    }
   		    // Redagavimas 
   		    $( ".edit" ).each ( function()
   		    {
   		    	$( this ).button().click ( function()
   		    	{
   		    		id_prekes = $( this ).data ( 'el_id' );
   		    		
   					$.ajax(
   					{
  						 method: 'POST'
  				 		 , url: '/preke'
  				 		 , data:
  				 		 	{
  				 		 		id: id_prekes
   				 		}		
   					}).done( function( data )
   						{
    						if ( data != null )
    						{
    							$( '#id').val ( data.id );
    							$( '#pav' ).val ( data.pavadinimas );
    							$( '#kaina' ).val ( data.kaina );
    							dialog_prideti.dialog( "open" );	// dialog_prideti					
   							}
   							console.log ( JSON.stringify ( data ) );
   				  	});			    		
   		    	});			    
   		    });
   		    //Pašalinimas
   		    var dialog_salinti;
   		    
   		    dialog_salinti = $( "#salinti_uzsakyma" ).dialog(
               {
                   autoOpen: false,
                   height: 300,
                   width: 300,
                   modal: true,
                   buttons:
                   {
                       "Pašalinti": function()
                       {
                       	dialog_salinti.dialog( "close" );
       					$( '#salinimo_forma' ).submit();
                       },
                       Cancel: function()
                       {
                       	dialog_salinti.dialog( "close" ); 
                       }
                   }
               });
   		    
   		    $('.delete').button().on('click', function() // +
    		{
   		    	id_prekes = $( this ).data ( 'el_id' );
	    		$('#id_prekes').val(id_prekes); console.log(id_prekes);
				dialog_salinti.dialog("open");
    		})
	  });
	</script>
</head>
<body class='container'>
	<div class="row align-items-center" id="page-header">
		<div class="col-4">
			<b id="imones_sukis">"Įmonės pavadinimas"</b>
		</div>
		<div class="col-4" id="menu">
			<nav>
				  <button type = "button" class="btn btn-outline-primary" onClick="location.href='pagrindinis';">Pagrindinis</button>
				  <button type = "button" class="btn btn-outline-primary" onClick="location.href='darbai';">--------</button>
				  <button type = "button" class="btn btn-outline-primary" onClick="location.href='employersRegister';">--------</button>
				  <button type = "button" class="btn btn-outline-primary" onClick="location.href='aboutUs';">--------</button>
			</nav>
		</div>
		<div class="col-4 justify-content-end">
			<div sec:authorize="!isAuthenticated()"> 
				<button type = "button" class="btn btn-outline-primary" onClick="location.href='login';">Prisijungti</button>
				<button type = "button" class="btn btn-outline-primary" onClick="location.href='register';">Registruotis</button>
			</div>
			<div sec:authorize="isAuthenticated()">
				<form th:action="@{/logout}" method="post">
					<input id="atsijungti" type="submit" value="Atsijungti">
					<span th:if="${#request != null}" th:text="${#request.userPrincipal.principal.getUsername()}"></span>
				</form> 
			</div>
		</div>
	</div>
		<div id="div_sukurti">
	    <form method="post" action="" id="sukurimo_forma">
			<label for="pav">Prekė</label>
			<input type="text" id="pav" name="pav" value="">
			<label for="kaina">Kaina</label>		
			<input type="text" id="kaina" name="kaina" value="">
			<input type="hidden" id="id" name="id" value="0">
	        <input type="hidden" name="prideti_name" value="prideti">
		 </form>
	</div>
    <div id="salinti_uzsakyma">
         <form method="post" action="/salinti-preke" id="salinimo_forma">
         	 <h3>Ar tikrai norite ištrinti pasirinktą prekę?</h3>
             <input type="hidden" name="id_prekes" id="id_prekes" value="0">
             <input type="hidden" name="salinti" value="salinti">
         </form>
    </div>
	<div class="row align-items-center">
		<button id="button_sukurti" style="height:50px; width:100px">Sukurti</button>
		<table>
			<tr>
				<td>Prekės pavadinimas</td>
				<td>Prekės kaina</td>
				<td>Redaguoti duomenis</td>
				<td>Pašalinti prekę</td>
			</tr>
			<tr th:each="preke : ${prekes}">
				<td th:text="${preke.getPavadinimas()}"></td>			
				<td th:text="${preke.getKaina()}"></td>
				<td><input type="button" class="edit" th:attr="data-el_id=${preke.getId()}" value="redaguoti"></td>			
				<td><input type="button" class="delete" th:attr="data-el_id=${preke.getId()}" value="pašalinti"></td>
			</tr>
		</table>
	</div>
</body>
</html>